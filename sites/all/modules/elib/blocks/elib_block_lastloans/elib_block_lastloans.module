<?php 


function elib_block_lastloans_block($op = 'list', $delta = 0) {
  if ($op == 'list') {
	  $blocks[]['info'] = t('Last loans');
	  $blocks[]['info'] = t('Newest books');
	  $blocks[]['info'] = t('Popular books books');
	  $blocks[]['info'] = t('dummyblock1 books');
	  $blocks[]['info'] = t('dummyblock2 books');
	  return $blocks;
  }
  elseif ($op == 'view') {
    //global $user;
    $block = array();
     
    
    elib_client()->setLibrary(variable_get('elib_retailer_id', ''));
    module_load_include('client.inc', 'ting');
    
    switch($delta){
    	case 0:
    		
		    $response = elib_client()->getLatestLoans();  
		    
		    foreach($response as $isbn){
		      $out .= elib_displaybookNEW(ting_get_object_by_isbn($isbn),'','small'); 
		    }
		    $block['subject'] = t('Top 5 mest lånte');	
    		break;
    	case 1:
    		$response = elib_client()->getNewBooks();
    		
    		if(is_array($response->data->toplistitem)){
	    		foreach($response->data->toplistitem as $item){
	    			//var_dump($item->ebookid);
	    			//print $item['ebookid'].'--';
	    			if(ting_get_object_by_isbn(trim($item->ebookid))){
	    				$out .= elib_displaybookNEW(ting_get_object_by_isbn(trim($item->ebookid)),'','small');
	    			}
	    			if($out == ''){
	    				$out = t('Der er ingen nye bøger');
	    			}
	    		}
    		} 
    		$block['subject'] = t('Nyeste bøger');
    		break;
    	case 3:
    		$out = 'popular books';
    		$block['subject'] = t('populære bøger');
    		break;
    		
    }
    
    //krumo($books);
    
    //$response = elib_client()->getNewBooks();
    
 
    
      
      $block['content'] = $out;

    
    
    return $block;
  }
  
} 















?>